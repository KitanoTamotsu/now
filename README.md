#### 開発メモ
[サンプル動画](https://user-images.githubusercontent.com/40127279/126054764-375b8576-4334-43dc-a5f3-03dd68abd815.mp4)
ワークフロー
<br><img width="600" src="https://user-images.githubusercontent.com/40127279/127757168-373aefbc-774f-45c8-ad0c-876a60a02db5.png">

### 1.スニペット起動を理解する
　スニペットは定型的なテキストを短縮語で呼び出す機能
<br>　即ち、キーボードから短縮語を入力すると、予め準備していたテキストに置き換えます
<br>
<br>　Alfredの場合2つの特色があります
<br>　・Alfred入力バーにスニペットを入力しても反応しない
<br>　・スニペットでワークフローを起動することができる
<br>　（スニペットとしてテキストの置き換えをしないロジックも可能）
<br>
<br>　スニペットを使えばAlfred入力バーを利用せずに、テキスト入力でワークフローを起動
<br>　できることになります
<br>　ただし、短縮語は固定文字列なので、引数は受け取ません
<br>　便利なような、使える場面が少ないような。。。
### 2.入力ソースの切り替え
　Alfredのスニペット起動の使い道を考えたのですが
<br>　まず浮かんだのが、文字入力中に日本語入力と英字入力の切り替えをする機能
<br>
<br>　私はUK配列のキーボードなのですが、
<br>　OSXとしてCapsLockキーに『入力ソースを切り替える』機能を割り当てることができます
<br>　ただ、CapsLockキーが微妙に押しにくい場所にあったり、
<br>　左手小指で押すキーが多かったりするので、ちょっと使いにくいのです
<br>
<br>　スニペットであればキーワードなので自由に設定できそうです
<br>　とりあえず『..』で、入力ソースの切り替えをすることにしました
<br>
<br>　ところが、入力ソース切り替えのスクリプトがわかりません
<br>　仕方なく、Alfredワークフローのキーコンボを使って入力ソース切り替えを実装　
<br>
<br>　でもあまり思ったように動きません。
<br>　なぜかというと、英字入力中の『.』は、文末のピリオドと解釈されるのか、3連続の
<br>　ピリオドでないと反応しません。そもそも日本語入力では半角のピリオドも打ちにくい
<br>
<br>　ちょっと待てよ、キーストロークだけを考えると
<br>　CapsLockの場合、1プッシュ。OSXのショートカットでは⌥+スペースの2プッシュ。
<br>　Alfredスニペットでは最大3プッシュ。
<br>　1プッシュで実装が必要と考え、何かよいキーがないか探したら、ありました
<br>　左上の『§』
<br>
<br>　最終的にはAlfredではなく、OSXのショートカット設定で対応できました
<br> （fnキーと『§』キーを同時押しして登録ができ、単独キーで使えます）
<br>　『§』や『±』（シフト＋§）は入力できなくなりましたが、使わない文字ですからね
<br>　自分的には満足ですが、Alfredを使わずに解決してしまいました
### 3.日付フォーマット
　次に考えたのが、時候の挨拶
<br>　月や二十四節気にあわせて、動的にスニペットするみたいな
<br>　でも、時候の挨拶を書くようなことはまずない
<br>
<br>　そうだ、今日の日付にしよう
<br>　.nowと入力すると、日付フォーマットを表示して、使いたいものを選ぶという流れ
<br>
<br>　日付、日付＋時刻、時刻という感じでいくつかパターンを作ればOK
<br>　
<br>　ロジックは簡単です
<br>　dateコマンドで日付を取得して、表示フォーマットを出力用のJSONにセットするだけ
<br>　なお、どの程度発生するのかわかりませんが、処理中に秒が進むのが嫌だったので
<br>　現在時刻は1回だけの取得しています
<br>
<br>　修正がしやすいようにベタベタのロジックで、配列をどんどん追加していき
<br>　最後にループでJSONを作成するという感じです
<br>　具体的には、現在の配列全体[@]にブランクと追加要素を書いて括弧でくくっています
<br>　これは配列の最後に要素を追加する手法です
<br>
<br>　ご自身がよく使う日付を出すのもよいでしょう
<br>　今月末みたいなものや、一定の締切日も作れます
### 4.Alfred入力バーから引数を受け取る
　ここまで書いて、ちょっと気になり、日付のフォーマットを出力したAlfredバーに文字を
<br>　入力してみると、その文字列をワークフローで受け取ることができました
<br>　（スニペット起動のワークフローでも引数が受け取れるようにできるのです）
<br>　そこで、"d"と入力したら、日付のバリエーションを表示するように制御を変更
<br>　とりあえず、月始や月末を作っています
<br>　
<br>　zshだと、日付のプラスマイナスは『-v』オプションを使います
<br>　dateコマンドのmanにあるexamplesが参考になるかも
<br>
<br>　ScriptFilter（前半ロジック） 
<br>　<img width="600" src="https://user-images.githubusercontent.com/40127279/127757232-9b17e793-d79f-412a-b0ca-93e87902ae84.png">
<br>　ScriptFilter（後半ロジック） 
<br>　<img width="600" src="https://user-images.githubusercontent.com/40127279/127757238-0da30753-dde0-4eb7-9bf2-2219f67d49f5.png">



#### 背景
　スニペットでのワークフロー起動があったので試してみました
<br>　スニペットは引数が取れないのが辛いと思いましたが
<br>　ScriptFileterを後続に置けるので引数が取り込めました
<br>　Alfred恐るべし
<br>　
#### 取扱説明
### 機能:
　現在の日時をフォーマット整形する
### インストール:
　1.[Alfredworkflow](https://github.com/KitanoTamotsu/now/releases/download/1.0/Now.alfredworkflow.zip)をダウンロード 
<br>　2.ファイルをダブルクリックしてワークフローに登録
### 使い方:
　スニペット（.now）を入力すると現在の日付と時刻の様々なフォーマットで表示
<br>　オプションとしてAlfredバーに"d"を入力すると日付のバリエーションを表示
<br>
<br>
[トップページに戻る](https://kitanotamotsu.github.io/)

