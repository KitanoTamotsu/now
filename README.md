## 　　Lesson25.　スニペット起動を使ってみる  
#### 開発メモ
### 1.スニペット起動を理解する
　スニペットは定型的なテキストを短縮語で呼び出す機能。
<br>　即ち、キーボードから、短縮後を入力すると、あらかじめ準備していたテキストに置き換えます。
<br>
<br>　Alfredの場合2つの特色があります
<br>　・Alfred入力バーにスニペットを入力しても反応しない
<br>　・スニペットでワークフローを起動することができる
<br>　（スニペットとしてテキストの置き換えをしないロジックも可能）
<br>
<br>　ということは、Alfredの入力バーを利用せずに、テキスト入力でワークフローを起動できることになります
<br>　ただし、短縮後は固定文字列なので、引数はうけとれません
<br>
<br>　便利なような、使える場面が少ないような。。。
### 2.入力ソースの切り替え
　Alfredのスニペット起動の使い道を考えたのですが
<br>　まず浮かんだのが、文字入力中に日本語入力と英字入力の切り替えをすること。
<br>
<br>　私はUK配列のキーボードなのですが、
<br>  OSXの機能としてCaps Lockキーに『入力ソースを切り替える』機能を割り当てることができます。
<br>　ただ、Caps Lockキーが微妙に押しにくい場所にあったり、
<br>　左手小指で押すキーが多かったりするので、ちょっと使いにくいのです
<br>
<br>　スニペットであればキーワードなので自由に設定できそうです
<br>　とりあえず『..』で、入力ソースの切り替えをすることにしました
<br>
<br>　ところが、入力ソース切り替えのスクリプトがわかりません
<br>　仕方なく、Alfredワークフローのキーコンボを使って入力ソース切り替えを実装　
<br>
<br>　でもあまり思ったように動きません。
<br>　英字入力中の『.』は、文末のピリオドと解釈されるのか、3連続のピリオドでないと反応しません『...』
<br>　そもそも日本語入力で半角のピリオドも打ちにくい
<br>
<br>　ちょっと待てよ、キーストロークだけを考えると
<br>　Caps Lockの場合、1プッシュ。OSXのショートカットでは⌥+スペースの2プッシュ。Alfredスニペットでは最大3プッシュ。
<br>　1プッシュで実装が必要と考え、何かよいキーがないか探したら、左上の『§』を発見。
<br>
<br>　試行錯誤の上、結局、Alfredではなく、OSXのショートカット設定で対応できました
<br> （fnキーと『§』キーを同時押しして登録ができました、単独キーで使えます）
<br>　『§』や『±』（シフト＋§）は入力できなくなりましたが、使わない文字ですからね
<br>　
<br>　自分的には満足ですが、Alfredを使わずに解決してしまいました
### 3.日付フォーマット
　次に考えたのが、時候の挨拶
<br>　月や二十四節気にあわせて、動的にスニペットするみたいな
<br>　でも、時候の挨拶を書くようなことはまずない
<br>
<br>　そうだ、今日の日付にしよう
<br>　.nowと入力すると、日付フォーマットを表示して、使いたいものを選ぶという流れ
<br>
<br>　日付、日付＋時刻、時刻という感じでいくつかパターンを作ればOK
<br>　
<br>　ロジックは簡単です
<br>　dateコマンドで日付を取得し　て、表示フォーマットを出力用のJSONにセットするだけ
<br>　なお、どの程度発生するのかわかりませんが、処理中に秒が進むのが嫌だったので
<br>　現在時刻は1回だけの取得しています
<br>
<br>　修正がしやすいようにベタベタのロジックで、配列をどんどん追加していき
<br>　最後にループでJSONを作成するという感じです。
<br>　ご自身がよく使う日付を出すのもよいでしょう
<br>　今月末みたいなものや、一定の締切日みたいなものも作れます
### 4.Alfred入力バーから引数を受け取る
　ここまで書いて、ちょっと気になり、日付のフォーマットを出力したAlfredバーから入力してみると
<br>　入力した文字列をワークフローで受け取ることができました。
<br>　そこで、"d"と入力したら、日付のバリエーションを表示するようにしてみました。
<br>　とりあえず、月始や月末を作っています
<br>　zshだと、日付のプラスマイナスは『-v』オプションを使います
<br>　dateコマンドのmanにexamplesが参考になるかも
<br>
#### 背景
　スニペットでのワークフロー起動があったのでつくってみました
<br>　スニペットは引数が取れないのが辛いと思いましがた
<br>　ScriptFileterを後続に置けるので引数が取り込めました
<br>　Alfred恐るべし
<br>　
#### 取扱説明
### 機能:
　現在の日時をフォーマット整形する
### インストール:
　1.[Alfredworkflow](https://github.com/KitanoTamotsu/now/releases/download/1.0/Now.alfredworkflow.zip)をダウンロード 
<br>　2.ファイルをダブルクリックしてワークフローに登録
### 使い方:
　スニペット（.now）を入力すると現在の日付と時刻の様々なフォーマットで表示
<br>　オプションとしてAlfredバーに"d"を入力すると日付のバリエーションを表示
<br>
<br>
[トップページに戻る](https://kitanotamotsu.github.io/)

